-- Latest Spare Part changes + most recent entry in T_ERP_ECO_ITM limited on the list of Patrick KÃ¶hnen
WITH latest_memo AS (
    SELECT 
        prt.C_ID,
        prt.PART_ID,
        prt.PART_VERSION,
        usr.C_NAME AS PRT_MODIFY_NAME,
        prt.SPARE,
        his.MODIFY_NAME,
        his.MEMO,
        his.MODIFY_DATE,
        ROW_NUMBER() OVER (PARTITION BY prt.C_ID ORDER BY his.MODIFY_DATE DESC) AS rn
    FROM T_MASTER_DAT prt
    INNER JOIN T_USER usr ON prt.C_UIC = usr.C_IC
    INNER JOIN T_MASTER_HIS his ON prt.C_ID = his.C_ID_1    
    WHERE 
        prt.CUR_FLAG = 'y'
        AND prt.PART_SUBTYPE = 'NRM'
        AND his.FUNCTION = 'MEMO'
        AND his.MEMO LIKE 'Spare Part Flag%'
),
latest_itm AS (
    SELECT 
        itm.ITEM_NUMBER,
        itm.REVISION,
        itm.ECO_NUMBER,
        itm.JOB_STATUS,
        itm.ECO_ITM_INTGR_JOB_STATUS,
        itm.PLM_ITEM_SPARE,
        ROW_NUMBER() OVER (PARTITION BY itm.ITEM_NUMBER, itm.REVISION ORDER BY itm.C_CRE_DAT DESC) AS rn
    FROM T_ERP_ECO_ITM itm
)
SELECT 
    lm.C_ID,
    lm.PART_ID,
    lm.PART_VERSION,
    lm.SPARE,
    lm.MODIFY_NAME AS HIS_MODIFY_NAME,
    lm.MEMO,
    lm.MODIFY_DATE,
    li.ECO_NUMBER,
    li.JOB_STATUS,
    li.ECO_ITM_INTGR_JOB_STATUS,
    li.PLM_ITEM_SPARE
FROM latest_memo lm
LEFT JOIN latest_itm li
    ON lm.PART_ID = li.ITEM_NUMBER
   AND NVL(lm.PART_VERSION, '-') = NVL(li.REVISION, '-')
   AND li.rn = 1
WHERE lm.rn = 1
    AND (
    (lm.PART_ID = '000028142' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '000251733' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '000251749' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '000251798' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '000350214' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '002330095' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '002330831' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '002451450' AND lm.PART_VERSION = 'D')
    OR (lm.PART_ID = '002520551' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '008324216' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '008364123' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '008364142' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '008364148' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '082312067' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '090260022' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '092500774' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '092514070' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '095500288' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '0960036' AND lm.PART_VERSION = 'N')
    OR (lm.PART_ID = '125053' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '125073' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '125081' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '125083' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '125088' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '125089' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '125090' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '125091' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '125092' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '125093' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '125097' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '125424' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '125444' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3213781' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3222407' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3244051' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3253587' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3261158' AND lm.PART_VERSION = 'F')
    OR (lm.PART_ID = '3266591' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3271550' AND lm.PART_VERSION = 'E')
    OR (lm.PART_ID = '3277066' AND lm.PART_VERSION = 'F')
    OR (lm.PART_ID = '3296946' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3314770' AND lm.PART_VERSION = 'E')
    OR (lm.PART_ID = '3315476' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3346916' AND lm.PART_VERSION = 'E')
    OR (lm.PART_ID = '3363733' AND lm.PART_VERSION = 'E')
    OR (lm.PART_ID = '3399566' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3399567' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3409274' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '3409609' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '3410552' AND lm.PART_VERSION = 'E')
    OR (lm.PART_ID = '3416871' AND lm.PART_VERSION = 'F')
    OR (lm.PART_ID = '3416873' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3416998' AND lm.PART_VERSION = 'G')
    OR (lm.PART_ID = '3417000' AND lm.PART_VERSION = 'F')
    OR (lm.PART_ID = '3417142' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3417281' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3417295' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3417299' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '3417313' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3417500' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3417501' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3417675' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3429182' AND lm.PART_VERSION = 'D')
    OR (lm.PART_ID = '3431936' AND lm.PART_VERSION = 'F')
    OR (lm.PART_ID = '3432270' AND lm.PART_VERSION = 'F')
    OR (lm.PART_ID = '3432825' AND lm.PART_VERSION = 'E')
    OR (lm.PART_ID = '3439346' AND lm.PART_VERSION = 'J')
    OR (lm.PART_ID = '3439507' AND lm.PART_VERSION = 'E')
    OR (lm.PART_ID = '3439904' AND lm.PART_VERSION = 'M')
    OR (lm.PART_ID = '3520412' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3553751' AND lm.PART_VERSION = 'I')
    OR (lm.PART_ID = '3554329' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3554937' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3559006' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3561742' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3562067' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3562296' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3610905' AND lm.PART_VERSION = 'D')
    OR (lm.PART_ID = '3611578' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3611584' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3612814' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3817449' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3853478' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3904128' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3904154' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '3904225' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3904335' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3904353' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3904361' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3904363' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '3904614' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3915185' AND lm.PART_VERSION = 'F')
    OR (lm.PART_ID = '3915187' AND lm.PART_VERSION = 'G')
    OR (lm.PART_ID = '3915667' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3929708' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3932657' AND lm.PART_VERSION = 'L')
    OR (lm.PART_ID = '3950567' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3964209' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3967131' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '3968941' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '3968942' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '3972650' AND lm.PART_VERSION = 'G')
    OR (lm.PART_ID = '3973544' AND lm.PART_VERSION = 'G')
    OR (lm.PART_ID = '3974197' AND lm.PART_VERSION = 'H')
    OR (lm.PART_ID = '3976817' AND lm.PART_VERSION = 'F')
    OR (lm.PART_ID = '3978151' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3983666' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '3999968' AND lm.PART_VERSION = 'J')
    OR (lm.PART_ID = '400002897' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '400013600' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '400013609' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '400015336' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '400016381' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '400016462' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '400017715' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '400017737' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '400017775' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '400028915' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4119649' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '4263352' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4263549' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4264352' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '4265461' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4265536' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4266312' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4267550' AND lm.PART_VERSION = 'F')
    OR (lm.PART_ID = '4307607' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4307610' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4375223' AND lm.PART_VERSION = 'D')
    OR (lm.PART_ID = '4398593' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4398595' AND lm.PART_VERSION = 'I')
    OR (lm.PART_ID = '4483937' AND lm.PART_VERSION = 'I')
    OR (lm.PART_ID = '4512644' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '4525837' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4529911' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4537142' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '4594420' AND lm.PART_VERSION = 'P')
    OR (lm.PART_ID = '4594649' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '4601294' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4605771' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4632642' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4637086' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '4681552' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4684414' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '4720935' AND lm.PART_VERSION = 'E')
    OR (lm.PART_ID = '4843053' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '4879383' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '507604' AND lm.PART_VERSION = 'F')
    OR (lm.PART_ID = '511392' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '572870' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '575209' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '576038' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '6014162' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '6014198' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '6045617' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '6046060' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '6090415' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '6128245' AND lm.PART_VERSION = 'E')
    OR (lm.PART_ID = '6144491' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '6156497' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '6161296' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '6173299' AND lm.PART_VERSION = 'F')
    OR (lm.PART_ID = '6204297' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '622587' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '6272656' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '629365' AND lm.PART_VERSION = 'D')
    OR (lm.PART_ID = '652067' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '654303' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '654313' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '669822' AND lm.PART_VERSION = 'D')
    OR (lm.PART_ID = '671599' AND lm.PART_VERSION = 'D')
    OR (lm.PART_ID = '671603' AND lm.PART_VERSION = 'D')
    OR (lm.PART_ID = '671609' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '671610' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '671611' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '671617' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '671620' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '671621' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '671622' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '671639' AND lm.PART_VERSION = 'D')
    OR (lm.PART_ID = '671752' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '672400' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '673970' AND lm.PART_VERSION = 'E')
    OR (lm.PART_ID = '673972' AND lm.PART_VERSION = 'F')
    OR (lm.PART_ID = '674126' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '674136' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '677883' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '677884' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '678783' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '678784' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '678798' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '691989' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '7672762' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '7688994' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '7744800' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9502554' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9517141' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '9522139' AND lm.PART_VERSION = 'C')
    OR (lm.PART_ID = '9522152' AND lm.PART_VERSION = 'E')
    OR (lm.PART_ID = '9533638' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9534289' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9534586' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9534777' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9549149' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9560204' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9560799' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9560850' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9566329' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '9603825' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9660671' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9694176' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '9798123' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9823198' AND lm.PART_VERSION = 'E')
    OR (lm.PART_ID = '9829735' AND lm.PART_VERSION = 'D')
    OR (lm.PART_ID = '9829833' AND lm.PART_VERSION = 'A')
    OR (lm.PART_ID = '9833902' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '9833903' AND lm.PART_VERSION = 'B')
    OR (lm.PART_ID = '9843036' AND lm.PART_VERSION = 'A')
    )
ORDER BY lm.PART_ID ASC;