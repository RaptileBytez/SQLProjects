/*
===============================================================================
Script Name: APPPLM-3801-JW_Rollback_ECOs.sql
===============================================================================
Description: Rollback script for APPPLM-3801 
Author: Jesco Wurm (ICP)
Creation Date: 24-06-2025
Version: 1.0.1
Last Modified: 24-06-2025
Last Modified By: Jesco Wurm (ICP)
--------------------------------------------------------------------------------
Purpose: 
This script will 
    - return ECO to the status 820, which is the status before the ECO was released.
    - delete the history record for the Release step of each ECO
    - set the JOB_STATUS in the T_ERP_ECO Queue to '3'.
--------------------------------------------------------------------------------  
Change History:
- 24-06-2025: Initial creation of the script
- 24-06-2025: Version 1.0.1: Added logic to roll back the Folders of the ECOs and delete the Folder history records, too.
===============================================================================
 */
BEGIN
  EXECUTE IMMEDIATE q'{
    CREATE GLOBAL TEMPORARY TABLE APPPLM_3801_ECO_LIST (
      eco_id VARCHAR2(20) PRIMARY KEY
    ) ON COMMIT PRESERVE ROWS
  }';
EXCEPTION
  WHEN OTHERS THEN NULL;
END;
/

TRUNCATE TABLE APPPLM_3801_ECO_LIST;

    --The following 414 ECOs are taken from the file "export_too_early_released_SAPPO_tasks_May25.xlsx"
    --listing 460 ECOs and were compared to the file "Tasks not completed 01-01-2022 tot 01-06-2025.xls.xlsx".
    --Those 414 ECOs are the ones which appear in both files.
    INSERT ALL
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341006')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340997')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340998')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340994')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338463')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338465')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340993')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340982')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340959')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340909')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340957')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340644')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340953')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340784')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340905')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340866')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340900')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2287143')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340881')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329668')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2287188')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340855')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338472')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340849')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340835')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340836')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340829')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340801')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340797')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340796')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340794')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340791')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340765')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340338')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340498')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339884')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340725')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340716')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340689')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340684')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340679')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340671')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340289')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340660')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340647')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340634')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340633')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341031')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338973')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338993')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340455')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338968')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340494')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340497')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340448')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340428')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340439')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340461')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340457')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336762')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340443')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340405')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340383')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340364')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340125')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340377')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340373')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340001')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340367')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339397')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340356')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340346')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340343')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340330')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338072')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340219')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340179')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340172')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340156')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2327517')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339674')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340140')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340100')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340114')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340115')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340069')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337635')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338470')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340032')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339913')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339989')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339988')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340009')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339672')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339992')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339976')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339562')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337802')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339646')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339951')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339950')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339476')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339926')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339889')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339909')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329042')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339901')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337694')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339858')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339853')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339847')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339838')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338599')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339745')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340621')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340451')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340487')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340468')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340603')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340596')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340583')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340578')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340585')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338497')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340533')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339068')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339011')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339158')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339133')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339067')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339112')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339014')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338962')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338829')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338760')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2334133')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2331140')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338865')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338775')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338756')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339640')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339636')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336367')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333354')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339593')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339162')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339538')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339501')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339215')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339484')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339417')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339400')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339392')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339393')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339389')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339384')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339379')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336278')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339350')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336391')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339278')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2339277')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338355')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337510')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337974')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338327')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337246')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337772')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2335780')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338271')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338125')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338227')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338064')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337960')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2325230')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338767')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2327605')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338759')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336619')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337897')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338753')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338752')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338076')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338484')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2304817')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338697')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2309537')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338617')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338597')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2235960')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338551')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338537')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338212')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338516')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338493')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337568')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338481')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338419')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2338192')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337977')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337955')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337116')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337628')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337929')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337157')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337688')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337837')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337797')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337823')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337627')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337814')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337789')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337784')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337405')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337717')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2334154')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337625')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337579')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337200')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337358')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337524')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337500')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337323')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337444')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337298')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337269')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337254')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337240')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337251')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337192')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336814')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337184')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337183')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337185')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337152')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337139')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337132')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337108')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336534')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337046')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337045')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337041')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337030')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337013')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337009')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333299')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336907')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336765')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336695')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336686')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336647')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336678')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336525')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2302514')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336540')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336357')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336338')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332215')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336200')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2336103')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2335995')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333456')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2335529')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2334400')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2335384')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2335257')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2331300')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2335174')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329299')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2335119')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2334336')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2330699')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2334930')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332917')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2334835')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2334206')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2334414')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2334511')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2334392')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2334021')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2334055')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333935')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333444')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2334010')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333932')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333790')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333871')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333834')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333874')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333838')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333315')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333318')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332820')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333598')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2328474')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333524')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2328473')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2328476')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333363')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333338')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333219')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329111')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333006')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333207')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333032')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333106')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332403')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2333037')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332965')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332960')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332876')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332359')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2331950')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332638')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332480')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332134')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332407')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332052')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2326140')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332169')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2272793')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2331948')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2331748')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2331662')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2332511')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2331609')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2331327')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329939')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2330074')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329898')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329176')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2330680')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2330393')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2330300')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329901')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2330103')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2330055')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329884')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2328678')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329617')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329252')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329243')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329263')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2329160')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2328945')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2328754')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2328407')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2328210')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2328266')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2313124')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2328037')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2326410')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2324501')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2327560')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2327008')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2326598')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2325998')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2325064')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2325873')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2326391')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2325045')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2324913')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2324857')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2309236')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2324752')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2324341')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2323276')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2319510')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2323277')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2322457')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320693')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320469')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320458')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320454')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320571')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320573')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320575')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320564')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320548')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320662')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320461')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320629')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320570')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320786')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320774')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320788')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320650')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320546')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320655')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320653')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2320648')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2317321')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2315438')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2311293')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2313778')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2305994')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2299998')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2291988')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2337704')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341018')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340992')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341034')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341021')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341035')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341043')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2340974')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341049')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341051')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341048')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341055')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341056')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341036')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341053')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341050')
      INTO  APPPLM_3801_ECO_LIST(eco_id) VALUES('2341041')

    SELECT * FROM dual;

-- Enable DBMS_OUTPUT
SET SERVEROUTPUT ON;

DECLARE
  CURSOR eco_cur IS
    SELECT eco_id FROM APPPLM_3801_ECO_LIST;
  v_eco_id APPPLM_3801_ECO_LIST.eco_id%TYPE;
  v_pac_ref T_EWO_DAT.pac_ref%TYPE;

  v_update_count NUMBER;
  v_delete_count NUMBER;
  v_job_update_count NUMBER;
  v_folder_update_count NUMBER;
  v_folder_delete_count NUMBER;
  
BEGIN
  FOR rec IN eco_cur LOOP
    v_eco_id := rec.eco_id;

    -- Get PAC_REF for this ECO
    BEGIN
      SELECT PAC_REF
        INTO v_pac_ref
        FROM T_EWO_DAT
       WHERE elem_id = v_eco_id
         AND ROWNUM = 1;
    EXCEPTION
      WHEN NO_DATA_FOUND THEN
        v_pac_ref := NULL;
    END;

    -- If no PAC_REF, skip further processing for this ECO
    IF v_pac_ref IS NULL THEN
      DBMS_OUTPUT.PUT_LINE('Skipping ECO ' || v_eco_id || ' due to missing PAC_REF.');
      CONTINUE;
    END IF;

    -- 1) Reset ECO LEV_IND
    UPDATE T_EWO_DAT
       SET lev_ind = 820
     WHERE elem_id = v_eco_id
       AND lev_ind = 830;
    v_update_count := SQL%ROWCOUNT;

    -- 2) Delete ECO History 
    DELETE FROM T_EWO_HIS
     WHERE old_lev_ind = 820
       AND new_lev_ind = 830
       AND modify_name = 'STREAM_SAP'
       AND c_id_1 IN (
             SELECT c_id
               FROM T_EWO_DAT
              WHERE elem_id = v_eco_id
           );
    v_delete_count := SQL%ROWCOUNT;

    -- 3) Reset Folder LEV_IND
    UPDATE T_PAC_DAT
        SET lev_ind = 820
      WHERE PAC_ID = v_pac_ref
        AND lev_ind = 830;
    v_folder_update_count := SQL%ROWCOUNT;

    -- 4) Delete the Folder History
    DELETE FROM T_PAC_HIS
     WHERE old_lev_ind = 820
       AND new_lev_ind = 830
       AND modify_name = 'STREAM_SAP'
       AND c_id_1 IN (
             SELECT c_id
               FROM T_PAC_DAT
              WHERE pac_id = v_pac_ref
           );
    v_folder_delete_count := SQL%ROWCOUNT;

    -- 5) Set JOB_STATUS 
    UPDATE T_ERP_ECO
       SET job_status = '3'
     WHERE eco_number = v_eco_id;
    v_job_update_count := SQL%ROWCOUNT;

    -- Output what was done for this ECO
    DBMS_OUTPUT.PUT_LINE('ECO ' || v_eco_id || ':');
    DBMS_OUTPUT.PUT_LINE('  - T_EWO_DAT updated: ' || v_update_count);
    DBMS_OUTPUT.PUT_LINE('  - T_EWO_HIS deleted: ' || v_delete_count);
    DBMS_OUTPUT.PUT_LINE('  - T_PAC_DAT updated: ' || v_folder_update_count);
    DBMS_OUTPUT.PUT_LINE('  - T_PAC_HIS deleted: ' || v_folder_delete_count);
    DBMS_OUTPUT.PUT_LINE('  - T_ERP_ECO updated: ' || v_job_update_count);
    DBMS_OUTPUT.PUT_LINE('----------------------------------------');
  END LOOP;

  COMMIT;
END;
/